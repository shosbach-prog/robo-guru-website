import{fieldValidation,handleScrollAndFocusOnError}from"@Scripts/validation";let check="<svg aria-hidden='true' width='10' height='8' viewBox='0 0 10 8' fill='none' xmlns='http://www.w3.org/2000/svg'><path d='M9 1L3.5 6.5L1 4' stroke='#1E1E1E' stroke-opacity='0.5' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/></svg>",setCurrentActive=(e,t,i)=>{switch(i){case"progress-bar":return`Step ${e} of `+t;case"connector":return e+" / "+t;default:return""}};class PageBreakHandler{constructor(e){var t;e?.closest(".srfm-cf-ctn")||(this.form=e,this.pageBreakContainers=e.querySelectorAll(".srfm-page-break"),this.pageBreakContainers&&!(t=this.pageBreakContainers[0])?.querySelector("div.srfm-block, div.uagb-block")&&(t?.remove(),this.pageBreakContainers=e.querySelectorAll(".srfm-page-break")),this.pageBreakLength=this.pageBreakContainers.length,this.gcaptchaDiv=e.querySelector(".g-recaptcha"),this.hcaptchaDiv=e.querySelector(".h-captcha"),this.turnstileDiv=e.querySelector(".cf-turnstile"),this.submitBtn=e.querySelector(".srfm-submit-container"),this.ajaxUrl=e.getAttribute("ajaxurl"),this.nonce=e.getAttribute("data-nonce")||e.getAttribute("nonce"),this.formId=e.getAttribute("form-id"),this.pageBreakHeader=e.querySelector(".srfm-page-break-header-container"),this.stepsParentDiv=e.querySelector(".srfm-page-break-progress-container"),this.pageBreakHeader&&(this.pagebreakCount=this.pageBreakHeader.querySelector(".srfm-step-count"),this.pagebreakTotalCount=this.pageBreakHeader.querySelector(".srfm-step-total"),this.pagebreakPageTitle=this.pageBreakHeader.querySelector(".srfm-steps-page-title"),this.progressIndicatorType=this.pageBreakHeader.getAttribute("type"),this.isShowLabel=this.pageBreakHeader.getAttribute("toggle-label"),this.connectorWrapper=e.querySelector(".srfm-progress-connector")),this.connectorParentDiv=e.querySelector(".srfm-steps-container"),this.currentActive=0,window.srfmFrontendData=window.srfmFrontendData||{},window.srfmFrontendData.currentPageBreakFormStep=this.currentActive,document.addEventListener("srfmGotoStep",e=>{e=e.detail.step;e<0||e>=this.pageBreakLength||(this.currentActive=parseInt(e,10),this.welcomeScreen&&(this.welcomeScreen.style.display="none",this.pageBreakHeader&&(this.pageBreakHeader.style.display="block"),this.pageBreakBtnContainer.style.display="flex"),this.currentActive===this.pageBreakLength-1?(this.nxtBtn.style.display="none",this.submitBtn.style.display="block",this.toggleCaptchaVisibility(!0),this.nxtBtn.replaceWith(this.submitBtn),this.toggleSaveResumeLink(!1),this.toggleSaveResumeSubmitLinkContainer(!0)):(this.toggleSaveResumeLink(!0),this.toggleSaveResumeSubmitLinkContainer(!1)),0!==this.currentActive?this.preBtn.style.visibility="visible":this.preBtn.style.visibility="hidden",window.srfmFrontendData.currentPageBreakFormStep=this.currentActive,this.updateProgressIndicator(),this.updatePageBreakDisplay(),this.update())}),this.preBtn=e.querySelector(".srfm-pre-btn"),this.nxtBtn=e.querySelector(".srfm-nxt-btn"),this.saveResumeLink=e.querySelector(".srfm-save-resume-link"),this.saveResumeSubmitLinkContainer=e.querySelector(".srfm-save-resume-submit-link-ctn"),this.saveResumePageBreakContainer=e.querySelector(".srfm-save-resume-page-break-ctn"),this.originalNxtBtn=this.nxtBtn,"progress-bar"===this.progressIndicatorType&&(this.progressBar=this.pageBreakHeader.querySelector(".srfm-page-break-indicator")),this.anchor=e.querySelector("#srfm-anchor"),this.welcomeScreen=e.querySelector(".srfm-welcome-screen"),this.pageBreakBtnContainer=e.querySelector(".srfm-page-break-buttons"),e.querySelectorAll(".srfm-page-break").forEach(t=>{t.addEventListener("keydown",e=>{if("Enter"===e.key&&"TEXTAREA"!==t.ownerDocument.activeElement.tagName)return e.preventDefault(),!1})}))}announcePage(){this.anchor?.focus(),wp.a11y.speak(window?.srfm?.srfmSprintfString(window?.srfm_submit?.messages?.page_break_page_number,this.currentActive+1,this.pageBreakLength))}createPageBreakElements(){var t,i,s;"steps"===this.progressIndicatorType&&this.connectorWrapper?this.connectorWrapper.innerHTML="":"connector"===this.progressIndicatorType&&this.connectorParentDiv&&this.connectorParentDiv.querySelectorAll(".srfm-round").forEach(e=>e.remove());for(let e=0;e<this.pageBreakLength;e++)"steps"===this.progressIndicatorType?((i=document.createElement("li")).classList.add("srfm-circle"),(t=document.createElement("div")).classList.add("srfm-circle-shape"),t.innerHTML=check,i.append(t),this.isShowLabel&&((t=document.createElement("span")).classList.add("srfm-circle-text"),t.innerHTML=this.pageBreakContainers[e].getAttribute("data"),i.append(t)),0===e&&i.classList.add("active"),this.connectorWrapper.appendChild(i)):"connector"===this.progressIndicatorType&&((t=document.createElement("div")).className="srfm-round",0===e&&t.classList.add("active"),(i=document.createElement("input")).classList.add("srfm-round-checkbox"),i.type="checkbox",i.id="srfm-round-checkbox-"+e,i.disabled=!0,(s=document.createElement("label")).htmlFor="srfm-round-checkbox-"+e,s.innerHTML=check,t.appendChild(i),t.appendChild(s),this.connectorParentDiv.appendChild(t));"steps"===this.progressIndicatorType?this.wraps=this.form.querySelectorAll(".srfm-circle"):"connector"===this.progressIndicatorType?(this.wraps=this.form.querySelectorAll(".srfm-round"),this.checkbox=this.form.querySelectorAll(".srfm-round-checkbox"),this.pagebreakCount&&(this.pagebreakCount.textContent=setCurrentActive(1,this.pageBreakLength,this.progressIndicatorType),this.isShowLabel)&&(this.pagebreakPageTitle.innerHTML=this.pageBreakContainers[0].getAttribute("data"))):"progress-bar"===this.progressIndicatorType&&(this.pagebreakCount.textContent=setCurrentActive(1,this.pageBreakLength,this.progressIndicatorType),this.isShowLabel)&&(this.pagebreakPageTitle.innerHTML=this.pageBreakContainers[0].getAttribute("data"))}initializeFormState(t){this.welcomeScreen?(this.pageBreakHeader&&(this.pageBreakHeader.style.display="none"),this.pageBreakBtnContainer.style.display="none",this.welcomeScreen.querySelector(".srfm-start-btn").addEventListener("click",e=>{e.preventDefault(),this.welcomeScreen.style.display="none",this.pageBreakContainers[this.currentActive].classList.add("right"),this.pageBreakContainers[this.currentActive].style.display="flex",this.pageBreakBtnContainer.style.display="flex",this.pageBreakHeader&&(this.pageBreakHeader.style.display="block")})):this.pageBreakContainers[this.currentActive].style.display="flex",this.submitBtn.style.display="none",this.submitBtn.style.width="auto",this.submitBtn.style.margin="0",this.toggleCaptchaVisibility(!1),this.toggleSaveResumeSubmitLinkContainer(!1),this.preBtn&&0===this.currentActive&&(this.preBtn.style.visibility="hidden"),this.nxtBtn&&this.nxtBtn.addEventListener("click",e=>this.handleNextButtonClick(e,t)),this.preBtn&&this.preBtn.addEventListener("click",e=>this.handlePreviousButtonClick(e,t)),"progress-bar"===this.progressIndicatorType&&this.updateProgressBarIndicator()}async handleNextButtonClick(e){e.preventDefault();e=await fieldValidation(this.formId,this.ajaxUrl,this.nonce,this.pageBreakContainers[this.currentActive]);e?handleScrollAndFocusOnError(e):(this.currentActive++,this.announcePage(),this.currentActive===this.pageBreakLength-1?(this.nxtBtn.style.display="none",this.submitBtn.style.display="block",this.toggleCaptchaVisibility(!0),this.nxtBtn.replaceWith(this.submitBtn),this.toggleSaveResumeLink(!1),this.toggleSaveResumeSubmitLinkContainer(!0)):(this.toggleSaveResumeLink(!0),this.toggleSaveResumeSubmitLinkContainer(!1)),0!==this.currentActive&&(this.preBtn.style.visibility="visible"),window.srfmFrontendData.currentPageBreakFormStep=this.currentActive,this.updateProgressIndicator(),this.updatePageBreakDisplay(),this.update())}handlePreviousButtonClick(e){e.preventDefault(),this.currentActive--,this.announcePage(),this.currentActive<=0&&(this.preBtn.style.visibility="hidden"),this.currentActive<=this.pageBreakLength-1&&(this.nxtBtn.disabled=!1,"block"===this.submitBtn.style.display)&&(this.submitBtn.style.display="none",this.toggleCaptchaVisibility(!1),this.originalNxtBtn.style.display="block",this.submitBtn.replaceWith(this.originalNxtBtn)),window.srfmFrontendData.currentPageBreakFormStep=this.currentActive,this.toggleSaveResumeLink(!0),this.toggleSaveResumeSubmitLinkContainer(!1),this.updateProgressIndicator(),this.updatePageBreakDisplay(),this.update()}updatePageBreakDisplay(){for(let e=0;e<this.pageBreakLength;e++)this.pageBreakContainers[e]&&(this.pageBreakContainers[e].style.display=e===this.currentActive?"flex":"none"),e<this.currentActive?(this.pageBreakContainers[e].classList.add("left"),this.pageBreakContainers[e].classList.remove("right"),this.wraps&&"steps"===this.progressIndicatorType&&this.wraps[e].classList.add("filled"),this.checkbox&&(this.checkbox[e].checked=!0)):(this.pageBreakContainers[e].classList.add("right"),this.pageBreakContainers[e].classList.remove("left"),this.wraps&&"steps"===this.progressIndicatorType&&this.wraps[e].classList.remove("filled"),this.checkbox&&(this.checkbox[e].checked=!1))}toggleSaveResumeLink(e){this.saveResumeLink&&(e?(this.saveResumeLink.style.display="",this.saveResumeLink.style.visibility="visible"):(this.saveResumeLink.style.display="none",this.saveResumeLink.style.visibility="hidden"))}toggleSaveResumeSubmitLinkContainer(e){this.saveResumeSubmitLinkContainer&&(e?(this.saveResumeSubmitLinkContainer.style.display="",this.saveResumeSubmitLinkContainer.style.visibility="visible"):(this.saveResumeSubmitLinkContainer.style.display="none",this.saveResumeSubmitLinkContainer.style.visibility="hidden")),this.saveResumePageBreakContainer&&(this.saveResumePageBreakContainer.style.display=e?"block":"flex")}update(){this.wraps&&0!==this.wraps.length&&this.wraps.forEach((e,t)=>{t<=this.currentActive?e.classList.add("active"):e.classList.remove("active")}),"progress-bar"===this.progressIndicatorType&&this.updateProgressBarIndicator()}toggleCaptchaVisibility(e){e=e?"block":"none";this.gcaptchaDiv&&(this.gcaptchaDiv.style.display=e),this.hcaptchaDiv&&(this.hcaptchaDiv.style.display=e),this.turnstileDiv&&(this.turnstileDiv.style.display=e)}updateProgressIndicator(){("connector"===this.progressIndicatorType&&this.pagebreakCount||"progress-bar"===this.progressIndicatorType)&&(this.pagebreakCount.textContent=setCurrentActive(this.currentActive+1,this.pageBreakLength,this.progressIndicatorType),this.isShowLabel)&&(this.pagebreakPageTitle.innerHTML=this.pageBreakContainers[this.currentActive].getAttribute("data"))}updateProgressBarIndicator(){var e=Math.floor((this.currentActive+1)/this.pageBreakLength*100);this.progressBar.value=e}}document.addEventListener("DOMContentLoaded",function(){srfmLoadPageBreak()}),window.addEventListener("elementor/popup/show",function(e){e?.detail?.instance?.$element?.[0]?.querySelector(".srfm-form-container")&&srfmLoadPageBreak()}),window.srfmLoadPageBreak=function(){var e=Array.from(document.querySelectorAll(".srfm-form")).filter(e=>e.querySelector(".srfm-page-break"));if(e.length){let t=window?.srfm_page_break_data?.is_bricks_preview,i=window?.srfm_page_break_data?.is_elementor_preview;e.forEach(e=>{e=new PageBreakHandler(e);e.createPageBreakElements(),t||i||e.initializeFormState(t,i)})}};