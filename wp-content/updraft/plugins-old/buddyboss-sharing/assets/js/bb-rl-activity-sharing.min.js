!function(t){"use strict";var e={dropdown:null,modal:null,linkModal:null,activityModal:null,currentActivityId:null,currentShareType:null,currentPage:1,hasMorePages:!1,isLoadingThreads:!1,playVideoInModal:!1,init:function(){this.dropdown=t("#buddyboss-share-dropdown"),this.modal=t("#buddyboss-share-modal"),this.linkModal=t("#buddyboss-share-link-modal"),this.activityModal=t("#buddyboss-share-activity-modal"),0===this.dropdown.length&&console.warn("BuddyBoss Share: Dropdown element not found"),this.bindEvents(),this.initSelectedRecipients()},bindEvents:function(){t(document).on("click",".button.share.bp-secondary-action",this.handleShareClick.bind(this)),t(document).on("click",this.handleOutsideClick.bind(this)),t(document).on("click",".share-dropdown-item",this.handleDropdownOptionClick.bind(this)),t(document).on("click",".buddyboss-modal-close, .buddyboss-modal-overlay",this.closeModal.bind(this)),t(document).on("click",".buddyboss-share-modal-close, .buddyboss-share-modal-overlay",this.closeActivityModal.bind(this)),t(document).on("click",".share-activity-cancel",this.closeActivityModal.bind(this)),t(document).on("click",".share-activity-submit",this.handleActivityShareSubmit.bind(this)),t(document).on("click",".share-platform-btn",this.handlePlatformClick.bind(this)),t(document).on("click",".share-link-copy-btn",this.handleCopyLink.bind(this)),t(document).on("click",".share-submit-btn",this.handleShareSubmit.bind(this)),t(document).on("input",".share-search-input",this.handleSearch.bind(this)),t(document).on("click",".share-message-close",this.closeModal.bind(this)),t(document).on("click",".share-message-send-btn",this.handleMessageSend.bind(this)),t(document).on("input",".share-message-search-input",this.handleMessageSearch.bind(this)),t(document).on("keydown",this.handleKeyPress.bind(this)),t(document).on("reset","#bb-rl-whats-new-form",this.handleFormReset.bind(this)),t(document).on("click",".bp-activity-privacy__close",this.handleFormReset.bind(this)),t(document).on("click",".bb-rl-activity-content .shared-activity-preview, .shared-activity-message .shared-activity-preview",this.handleSharedActivityClick.bind(this));var e=this,a=function(a){var i=a.target,s=t(i),o=s.closest(".shared-activity-preview");if(0!==o.length&&!s.is(".shared-activity-preview")){var n=s.closest(".shared-activity-message").length>0;if(!(s.is("a.bb-rl-open-video-theatre, a.bb-open-video-theatre")||s.closest("a.bb-rl-open-video-theatre, a.bb-open-video-theatre").length>0)||!n)if(s.is(".vjs-icon-square, .enlarge_button")||s.closest(".vjs-icon-square, .enlarge_button").length>0){var r=(s.is(".vjs-icon-square, .enlarge_button")?s:s.closest(".vjs-icon-square, .enlarge_button")).closest(".video-js").parent().find(".bb-rl-open-video-theatre, .bb-open-video-theatre");r.length>0&&setTimeout(function(){var t=r[0];if(t){var e=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window});t.dispatchEvent(e)}},50)}else{if(n){var d=s.closest(".bb-activity-video-wrap");if(d.length>0&&d.hasClass("bb-video-length-1")&&(s.is("video, .video-js, .single-activity-video, .bb-rl-single-activity-video")||s.closest("video, .video-js, .single-activity-video, .bb-rl-single-activity-video, .vjs-control-bar, .vjs-big-play-button").length>0))return}var c=s.is(".vjs-big-play-button")||s.closest(".vjs-big-play-button").length>0;(s.is("a.bb-rl-open-media-theatre, a.bb-open-document-theatre, a.bb-rl-open-video-theatre, a.bb-open-video-theatre, a.bb-rl-entry-img, img, video, audio")||s.closest("a.bb-rl-open-media-theatre, a.bb-open-document-theatre, a.bb-rl-open-video-theatre, a.bb-open-video-theatre, a.bb-rl-entry-img, .bb-rl-activity-media-elem, .document-activity, .media-activity, .bb-activity-video-wrap, .bb-activity-video-elem, .bb-rl-activity-video-elem").length>0||c)&&(a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation(),c&&(e.playVideoInModal=!0),setTimeout(function(){o.trigger("click")},0))}}};document._buddybossSharingMediaHandler=a,document.addEventListener("click",a,!0),t(document).on("click",".bb-activity-model-wrapper .bb-model-close-button",this.cleanupSharedActivityModalClass.bind(this))},handleShareClick:function(e){e.preventDefault(),e.stopPropagation();var a=t(e.currentTarget);this.currentActivityId=a.data("activity-id"),this.closeDropdown();var i=a.offset(),s=a.outerHeight();this.dropdown.css({position:"absolute",top:i.top+s,left:i.left,display:"block"})},handleOutsideClick:function(e){t(e.target).closest(".button.share.bp-secondary-action, .buddyboss-share-dropdown").length||this.closeDropdown()},closeDropdown:function(){this.dropdown.hide()},handleDropdownOptionClick:function(e){e.preventDefault(),e.stopPropagation();var a=t(e.currentTarget);this.currentShareType=a.data("share-type"),this.closeDropdown(),"link"===this.currentShareType?this.openLinkModal():"feed"===this.currentShareType?buddybossSharingFrontend.enableCustomMsg?this.openActivityModal():this.shareDirectly():"message"===this.currentShareType?this.openMessageModal():"group"===this.currentShareType?this.openGroupModal():"profile"===this.currentShareType?this.openFriendsModal():this.openComposeModal()},openLinkModal:function(){t(".share-link-url-input").val("Loading..."),t(".share-link-platforms").removeClass("active"),this.linkModal.fadeIn(300),t("body").css("overflow","hidden"),t.ajax({url:buddybossSharingFrontend.ajaxUrl,type:"POST",data:{action:"buddyboss_get_activity_permalink",nonce:buddybossSharingFrontend.nonce,activity_id:this.currentActivityId},success:function(e){e.success&&e.data.permalink?t(".share-link-url-input").val(e.data.permalink):t(".share-link-url-input").val(window.location.href),t(".share-link-platforms").addClass("active")},error:function(){var e=t(".share-link-url-input").val();t(".share-link-url-input").val(e),t(".share-link-platforms").addClass("active")}})},openComposeModal:function(){this.modal.fadeIn(300),t("body").css("overflow","hidden"),this.loadShareContent()},openMessageModal:function(){var e=this;t(".buddyboss-share-message-modal-container").remove();var a=t('<div class="buddyboss-share-message-modal-container" style="display: none;"></div>');t("body").append(a),a.html('<div class="share-content-loading"><span class="spinner is-active"></span></div>'),t.ajax({url:buddybossSharingFrontend.ajaxUrl,type:"POST",data:{action:"buddyboss_get_share_modal_content",nonce:buddybossSharingFrontend.nonce,activity_id:this.currentActivityId,share_type:"message"},success:function(i){i.success?(a.html(i.data.content),a.fadeIn(300),t("body").css("overflow","hidden"),e.loadRecentThreads()):(e.showNotification(i.data.message||buddybossSharingFrontend.i18n.failedLoadModal,"error"),a.remove())},error:function(t,i,s){e.showNotification("An error occurred. Please try again.","error"),a.remove()}})},closeModal:function(e){if(e){var a=t(e.target);if(!a.hasClass("buddyboss-modal-close")&&!a.hasClass("buddyboss-modal-overlay")&&!a.hasClass("share-message-close")&&0===a.closest(".buddyboss-modal-close").length&&0===a.closest(".share-message-close").length)return}!this.currentActivityId||"feed"!==this.currentShareType&&"group"!==this.currentShareType&&"profile"!==this.currentShareType||t("#bb-rl-whats-new-form").find(".buddyboss-shared-activity-preview").length>0&&("feed"===this.currentShareType?this.cleanupSharedActivityForm():"group"===this.currentShareType?this.cleanupSharedActivityFormForGroup():"profile"===this.currentShareType&&this.cleanupSharedActivityFormForFriend()),this.modal.fadeOut(300),this.linkModal.fadeOut(300),t(".buddyboss-share-message-modal-container").fadeOut(300,function(){t(this).remove()}),t("body").css("overflow",""),this.currentActivityId=null,this.currentShareType=null},openActivityModal:function(){var e=this;this.clearDraftActivity(),t("body").addClass("bb-sharing-active");var a=t("#bb-rl-whats-new-form"),i=t("#bb-rl-activity-form");a.length&&i.length?(this.openBuddyBossPostForm(),this.loadAndInjectSharedActivity()):this.loadActivityPostForm().then(function(){e.openBuddyBossPostForm(),e.loadAndInjectSharedActivity()}).catch(function(t){console.error("Failed to load activity post form:",t),e.showNotification(buddybossSharingFrontend.i18n.error||"Failed to load post form","error")})},loadActivityPostForm:function(){return new Promise(function(e,a){if(t("#bb-rl-whats-new-form").length)e();else if(t("body").hasClass("activity-singular")){var i=t("#bb-rl-activity-form"),s=t("#bb-rl-single-activity-edit-form-wrap");i.length||(s.length?(i=t('<div id="bb-rl-activity-form" class="bb-rl-activity-update-form"></div>'),s.append(i),s.show()):(i=t('<div id="bb-rl-activity-form" class="bb-rl-activity-update-form"></div>'),t("body").append(i))),t.ajax({url:buddybossSharingFrontend.ajaxUrl,type:"POST",data:{action:"buddyboss_get_activity_post_form",nonce:buddybossSharingFrontend.nonce},success:function(s){if(s.success&&s.data.form_html){i.html(s.data.form_html);var o=0,n=function(){if(t("#bb-rl-whats-new-form").length)e();else if(o<20)o++,setTimeout(n,100);else if("undefined"!=typeof bp&&bp.Nouveau&&bp.Nouveau.Activity&&bp.Nouveau.Activity.postForm&&"function"==typeof bp.Nouveau.Activity.postForm.postFormView)try{bp.Nouveau.Activity.postForm.postFormView(),setTimeout(function(){t("#bb-rl-whats-new-form").length?e():a(new Error("Form initialization timeout"))},500)}catch(t){a(new Error("Failed to initialize form: "+t.message))}else a(new Error("Form initialization timeout - platform JS not available"))};setTimeout(n,200)}else{var r;a(new Error((null===(r=s.data)||void 0===r?void 0:r.message)||"Failed to load form"))}},error:function(t,e,i){a(new Error(i||"AJAX error"))}})}else e()})},openBuddyBossPostForm:function(){var e=t("#bb-rl-whats-new"),a=t("#bb-rl-whats-new-form"),i=a.closest(".bb-rl-activity-update-form"),s=t("#bb-rl-single-activity-edit-form-wrap");s.length&&s.is(":hidden")&&s.show(),i.length&&i.is(":hidden")&&i.show(),a.length&&a.is(":hidden")&&a.show(),e.length?setTimeout(function(){i.length&&!i.hasClass("modal-popup")&&(i.addClass("modal-popup"),t("body").addClass("bb-rl-activity-modal-open")),s.length&&s.show(),i.length&&i.show(),a.length&&a.show(),e.focus()},100):console.warn("BuddyBoss post form not found")},loadAndInjectSharedActivity:function(){var e=this;setTimeout(function(){t.ajax({url:buddybossSharingFrontend.ajaxUrl,type:"POST",data:{action:"buddyboss_get_activity_content",nonce:buddybossSharingFrontend.nonce,activity_id:e.currentActivityId},success:function(t){t.success&&e.injectSharedActivityToForm(t.data.content)},error:function(){console.error(buddybossSharingFrontend.i18n.failedLoadActivity)}})},300)},injectSharedActivityToForm:function(e){var a=t("#bb-rl-whats-new-form");a.addClass("activity-share-form"),a.find("#buddyboss-shared-activity-id").length||a.append('<input type="hidden" id="buddyboss-shared-activity-id" value="'.concat(this.currentActivityId,'">'));var i=t("#bb-rl-whats-new"),s=a.find(".buddyboss-shared-activity-preview");0===s.length&&(s=t('<div class="buddyboss-shared-activity-preview"></div>'),i.parent().after(s)),s.html(e),this.addLoadingIndicatorToPreview(s),this.initializeLazyLoading(s),this.initializeVideoJS(s),this.disableUploadButtons(),this.removeFeaturedImageButton(),this.hookFormSubmission(),"undefined"!=typeof bp&&bp.Nouveau&&bp.Nouveau.Activity&&bp.Nouveau.Activity.postForm&&bp.Nouveau.Activity.postForm.postForm&&bp.Nouveau.Activity.postForm.postForm.postValidate()},initializeVideoJS:function(e){"undefined"!=typeof videojs&&setTimeout(function(){e.find(".video-js.single-activity-video").each(function(){var e=t(this),a=e.attr("id");if(a&&!e.hasClass("vjs-initialized"))try{var i=e.closest(".bb-activity-video-elem").find(".bb-video-loader");videojs(a,{controls:!0,aspectRatio:"16:9",fluid:!0,playbackRates:[.5,1,1.5,2],fullscreenToggle:!1},function(){var t=this;i.length&&i.hide(),window.dispatchEvent&&window.dispatchEvent(new Event("resize")),t&&t.trigger&&t.trigger("resize")})}catch(t){console.error("Error initializing Video.js:",t)}})},100)},initializeLazyLoading:function(e){setTimeout(function(){e.find("img.lazy[data-src]").each(function(){var e=t(this),a=e.attr("data-src");a&&(e.attr("src",a),e.removeAttr("data-src"),e.on("load",function(){e.removeClass("lazy")}),t(document).trigger("bp_nouveau_lazy_load",{element:this}),e[0].complete&&e.trigger("load"))}),"undefined"!=typeof bp&&bp.Nouveau&&"function"==typeof bp.Nouveau.lazyLoad&&bp.Nouveau.lazyLoad(e.find("img.lazy"))},50)},disableUploadButtons:function(){setTimeout(function(){var e=t("#bb-rl-whats-new-toolbar");e.length?e.attr("data-share-disabled","true"):setTimeout(function(){var e=t("#bb-rl-whats-new-toolbar");e.length&&e.attr("data-share-disabled","true")},500)},300)},removeFeaturedImageButton:function(){var e=t(".bb-activity-post-feature-image-button");e.length&&e.remove()},hideEditFormWrapOnSingleActivityPage:function(){var e=t("#bb-rl-single-activity-edit-form-wrap");if(e.length&&t("body").hasClass("activity-singular")){e.hide();var a=e.find(".bb-rl-activity-update-form");a.length&&(a.removeClass("modal-popup"),t("body").removeClass("bb-rl-activity-modal-open"))}},hookFormSubmission:function(){var e=this;t("#bb-rl-whats-new-form").off("submit.buddyboss-share");var a=document.getElementById("bb-rl-whats-new-form");a?(a._buddybossShareHandler&&a.removeEventListener("submit",a._buddybossShareHandler,!0),a._buddybossShareHandler=function(a){var i=document.getElementById("buddyboss-shared-activity-id");if(i&&i.value){a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation();var s=t("#bb-rl-whats-new"),o="";s.is("[contenteditable]")?(s.find("img.emojioneemoji, img.bb-rl-emojioneemoji").replaceWith(function(){return this.dataset.emojiChar}),o=(o=t.trim(s[0].innerHTML.replace(/<div>/gi,"\n").replace(/<\/div>/gi,""))).replace(/&nbsp;/g," ")):o=s.val().trim();var n=t("#bb-rl-whats-new-form").find(".bp-activity-privacy__input:checked").val()||"public";return e.submitSharedActivity(i.value,o,n),!1}},a.addEventListener("submit",a._buddybossShareHandler,!0)):console.error("Form #bb-rl-whats-new-form not found!")},submitSharedActivity:function(e,a,i){var s=this,o=t("#aw-whats-new-submit"),n=o.text();o.prop("disabled",!0).text("Posting...");var r=0,d=!1,c=t("#buddypress .whats-new-topic-selector .bb-topic-selector-list li");if(console.log("[BuddyBoss Share RL Debug] Topic selector elements found:",c.length),c.length){d=!0;var l=c.find("a.selected");console.log("[BuddyBoss Share RL Debug] Selected topic links:",l.length),r=l.data("topic-id")||0,console.log("[BuddyBoss Share RL Debug] Final values - has_topic_selector:",d,", topic_id:",r)}t.ajax({url:buddybossSharingFrontend.ajaxUrl,type:"POST",data:{action:"buddyboss_share_to_feed",nonce:buddybossSharingFrontend.nonce,activity_id:e,custom_message:a,privacy:i,has_topic_selector:d,topic_id:r},success:function(e){if(e.success){if(s.showNotification(e.data.message||buddybossSharingFrontend.i18n.sharedSuccess,"success"),e.data.share_count&&s.updateShareCount(e.data.share_count),e.data.activity&&"undefined"!=typeof bp&&bp.Nouveau&&bp.Nouveau.inject){var a=bp.Nouveau.getStorage("bp-activity"),i=t('[data-bp-search="activity"] input[type="search"]').val(),r={},d=!1;i&&(i=new RegExp(i,"im"),r=e.data.activity.match(i)),i&&!r||(d=!a.filter||0===parseInt(a.filter,10)||"activity_update"===a.filter||"activity_share"===a.filter),d&&e.data.is_directory&&(d="all"===a.scope),d&&!t("#activity-"+e.data.id).length&&(t("#activity-stream ul.activity-list").length||t("#activity-stream").html(t("<ul></ul>").addClass("activity-list item-list bp-list")),t("#activity-stream ul.activity-list li:first.bb-pinned").length>0?bp.Nouveau.inject("#activity-stream ul.activity-list li:first.bb-pinned",e.data.activity,"after"):bp.Nouveau.inject("#activity-stream ul.activity-list",e.data.activity,"prepend"),jQuery(window).scroll())}s.clearDraftActivity(),s.cleanupSharedActivityForm(),t("#bb-rl-whats-new-form").trigger("reset")}else s.showNotification(e.data.message||buddybossSharingFrontend.i18n.error,"error"),o.prop("disabled",!1).text(n)},error:function(t,e,a){console.error("AJAX error:",{xhr:t,status:e,error:a}),s.showNotification(buddybossSharingFrontend.i18n.error,"error"),o.prop("disabled",!1).text(n)}})},clearDraftActivity:function(){"undefined"!=typeof bp&&bp.Nouveau&&bp.Nouveau.Activity&&bp.Nouveau.Activity.postForm&&"function"==typeof bp.Nouveau.Activity.postForm.resetDraftActivity&&bp.Nouveau.Activity.postForm.resetDraftActivity(!0)},cleanupSharedActivityForm:function(){t("#buddyboss-shared-activity-id").remove(),t(".buddyboss-shared-activity-preview").remove(),t("#bb-rl-whats-new-form").off("submit.buddyboss-share"),t("#bb-rl-whats-new-form").removeClass("activity-share-form"),t("body").removeClass("bb-sharing-active");var e=document.getElementById("bb-rl-whats-new-form");e&&e._buddybossShareHandler&&(e.removeEventListener("submit",e._buddybossShareHandler,!0),delete e._buddybossShareHandler);var a=t('#bb-rl-whats-new-toolbar[data-share-disabled="true"]');a.length&&a.show().removeAttr("data-share-disabled"),this.hideEditFormWrapOnSingleActivityPage(),this.currentActivityId=null,this.currentShareType=null,this.selectedGroup=null,this.selectedFriend=null,"undefined"!=typeof bp&&bp.Nouveau&&bp.Nouveau.Activity&&bp.Nouveau.Activity.postForm&&bp.Nouveau.Activity.postForm.postForm&&bp.Nouveau.Activity.postForm.postForm.postValidate()},closeActivityModal:function(e){e&&e.preventDefault(),this.cleanupSharedActivityForm(),t("#bb-rl-whats-new-form").trigger("reset"),this.hideEditFormWrapOnSingleActivityPage(),this.currentActivityId=null,this.currentShareType=null},loadActivityContent:function(){var e=this,a=t("#share-activity-preview");a.html('<div class="loading"><span class="spinner is-active"></span></div>'),t.ajax({url:buddybossSharingFrontend.ajaxUrl,type:"POST",data:{action:"buddyboss_get_activity_content",nonce:buddybossSharingFrontend.nonce,activity_id:this.currentActivityId},success:function(t){t.success?(a.html(t.data.content),e.addLoadingIndicatorToPreview(a)):a.html('<p class="error">'+buddybossSharingFrontend.i18n.failedLoadActivity+"</p>")},error:function(){a.html('<p class="error">'+buddybossSharingFrontend.i18n.failedLoadActivity+"</p>")}})},addLoadingIndicatorToPreview:function(t){var e=t.find(".shared-activity-content"),a=t.find(".activity-link-preview-container"),i=t.find(".bb-video-wrapper");e.length&&(e.addClass("shared-activity-content-loading"),e.prepend('<span class="activity-url-scrapper-loading activity-ajax-loader"><i class="bb-icon-l bb-icon-spinner animate-spin"></i> '+(buddybossSharingFrontend.i18n.loadingPreview||"Loading preview...")+"</span>")),a.length&&(a.addClass("activity-link-preview-loading"),a.prepend('<span class="activity-url-scrapper-loading activity-ajax-loader"><i class="bb-icon-l bb-icon-spinner animate-spin"></i> '+(buddybossSharingFrontend.i18n.loadingPreview||"Loading preview...")+"</span>")),i.length&&(i.addClass("bb-video-wrapper-loading"),i.prepend('<span class="activity-url-scrapper-loading activity-ajax-loader"><i class="bb-icon-l bb-icon-spinner animate-spin"></i> '+(buddybossSharingFrontend.i18n.loadingPreview||"Loading preview...")+"</span>")),this.waitForPreviewContentToLoad(t)},waitForPreviewContentToLoad:function(e){var a=this;this.forceLazyImagesToLoad(e),setTimeout(function(){var i=e.find("img"),s=e.find("video, iframe"),o=0,n=0,r=i.length,d=s.length,c=function(){o>=r&&n>=d&&setTimeout(function(){a.removeLoadingIndicator(e)},300)};0!==r||0!==d?(r>0&&i.each(function(e){var a=t(this);if(a.hasClass("lazy")&&a.attr("data-src")){var i=a.attr("data-src");a.attr("src",i).removeAttr("data-src").removeClass("lazy")}a[0].complete&&0!==a[0].naturalHeight?(o++,c()):(a.one("load error",function(){o++,c()}),a[0].complete&&a.trigger("load"))}),d>0&&s.each(function(e){var a=t(this);if(a.is("iframe")){var i=!1,s=a.attr("src"),o=a.attr("data-src");if(o&&!s&&(a.attr("src",o).removeAttr("data-src"),s=o),s){try{var r,d=a[0].contentDocument||(null===(r=a[0].contentWindow)||void 0===r?void 0:r.document);d&&"complete"===d.readyState&&(i=!0,n++,c())}catch(t){}i||(a.one("load",function(){i||(i=!0,n++,c())}),a.is(":visible"),setTimeout(function(){i||(i=!0,n++,c())},1500))}else{var l=0,u=function(){var t=a.attr("src")||a.attr("data-src");t?(a.attr("data-src")&&!a.attr("src")&&a.attr("src",t).removeAttr("data-src").removeAttr("data-lazy-type").removeClass("lazy"),h()):++l<10?setTimeout(u,200):(i=!0,n++,c())};setTimeout(u,100);var h=function(){a.one("load",function(){i||(i=!0,n++,c())}),a.is(":visible"),setTimeout(function(){i||(i=!0,n++,c())},1500)}}}else a.one("loadeddata canplay",function(){n++,c()})}),setTimeout(function(){a.removeLoadingIndicator(e)},3e3)):setTimeout(function(){a.removeLoadingIndicator(e)},100)},100)},forceLazyImagesToLoad:function(e){e.find("img.lazy[data-src]").each(function(){var e=t(this),a=e.attr("data-src");a&&(e.attr("src",a).removeAttr("data-src").removeClass("lazy"),t(document).trigger("bp_nouveau_lazy_load",{element:this}))}),e.find('iframe.lazy[data-src], iframe[data-lazy-type="iframe"][data-src]').each(function(){var e=t(this),a=e.attr("data-src");a&&(e.attr("src",a).removeAttr("data-src").removeAttr("data-lazy-type").removeClass("lazy"),t(document).trigger("bp_nouveau_lazy_load",{element:this}))}),"undefined"!=typeof bp&&bp.Nouveau&&"function"==typeof bp.Nouveau.lazyLoad&&bp.Nouveau.lazyLoad(e.find("img.lazy, iframe.lazy"))},removeLoadingIndicator:function(t){t.find(".activity-url-scrapper-loading").remove(),t.find(".shared-activity-content-loading").removeClass("shared-activity-content-loading"),t.find(".activity-link-preview-loading").removeClass("activity-link-preview-loading"),t.find(".bb-video-wrapper-loading").removeClass("bb-video-wrapper-loading")},handleActivityShareSubmit:function(e){var a=this;e.preventDefault();var i=t(e.currentTarget),s=t("#share-activity-message").val()||"",o=t("#share-activity-privacy").val()||"public";i.prop("disabled",!0).text("Posting...");var n=0,r=!1,d=t("#buddypress .whats-new-topic-selector .bb-topic-selector-list li");if(console.log("[BuddyBoss Share RL Debug] Topic selector elements found:",d.length),d.length){r=!0;var c=d.find("a.selected");console.log("[BuddyBoss Share RL Debug] Selected topic links:",c.length),n=c.data("topic-id")||0,console.log("[BuddyBoss Share RL Debug] Final values - has_topic_selector:",r,", topic_id:",n)}t.ajax({url:buddybossSharingFrontend.ajaxUrl,type:"POST",data:{action:"buddyboss_share_to_feed",nonce:buddybossSharingFrontend.nonce,activity_id:this.currentActivityId,custom_message:s,privacy:o,has_topic_selector:r,topic_id:n},success:function(t){t.success?(a.clearDraftActivity(),a.showNotification(t.data.message||buddybossSharingFrontend.i18n.sharedSuccess,"success"),t.data.share_count&&a.updateShareCount(t.data.share_count),setTimeout(function(){a.closeActivityModal()},1e3)):(a.showNotification(t.data.message||buddybossSharingFrontend.i18n.error,"error"),i.prop("disabled",!1).text("Post"))},error:function(){a.showNotification(buddybossSharingFrontend.i18n.error,"error"),i.prop("disabled",!1).text("Post")}})},loadShareContent:function(){var e=this,a=t(".share-content-area");a.html('<div class="share-content-loading"><span class="spinner is-active"></span></div>'),t.ajax({url:buddybossSharingFrontend.ajaxUrl,type:"POST",data:{action:"buddyboss_get_share_modal_content",nonce:buddybossSharingFrontend.nonce,activity_id:this.currentActivityId,share_type:this.currentShareType},success:function(t){t.success?(a.html(t.data.content),e.updateModalTitle(),"message"===e.currentShareType&&e.loadRecentThreads()):e.showError(t.data.message||buddybossSharingFrontend.i18n.error)},error:function(){e.showError(buddybossSharingFrontend.i18n.error)}})},updateModalTitle:function(){var e=t(".buddyboss-modal-title"),a="Create a post";switch(this.currentShareType){case"group":a="Share to a group";break;case"profile":a="Share to friend's profile";break;case"message":a="Share to message"}e.text(a)},shareDirectly:function(){var e=this,a=0,i=!1,s=t("#buddypress .whats-new-topic-selector .bb-topic-selector-list li");if(console.log("[BuddyBoss Share RL Debug] Topic selector elements found:",s.length),s.length){i=!0;var o=s.find("a.selected");console.log("[BuddyBoss Share RL Debug] Selected topic links:",o.length),a=o.data("topic-id")||0,console.log("[BuddyBoss Share RL Debug] Final values - has_topic_selector:",i,", topic_id:",a)}t.ajax({url:buddybossSharingFrontend.ajaxUrl,type:"POST",data:{action:"buddyboss_share_to_feed",nonce:buddybossSharingFrontend.nonce,activity_id:this.currentActivityId,custom_message:"",has_topic_selector:i,topic_id:a},success:function(a){if(a.success){e.showNotification(a.data.message||buddybossSharingFrontend.i18n.sharedSuccess,"success"),a.data.share_count&&e.updateShareCount(a.data.share_count);var i=t("body").hasClass("activity-singular");if(a.data.activity&&"undefined"!=typeof bp&&bp.Nouveau&&bp.Nouveau.inject&&!i){var s=bp.Nouveau.getStorage("bp-activity"),o=t('[data-bp-search="activity"] input[type="search"]').val(),n=!1;(n=!o||!!a.data.activity.match(new RegExp(o,"im")))&&s.filter&&0!==parseInt(s.filter,10)&&"activity_update"!==s.filter&&"activity_share"!==s.filter&&(n=!1),n&&a.data.is_directory&&"all"!==s.scope&&(n=!1),n&&!t("#activity-"+a.data.id).length&&(t("#activity-stream ul.activity-list").length||t("#activity-stream").html(t("<ul></ul>").addClass("activity-list item-list bp-list")),t("#activity-stream ul.activity-list li:first.bb-pinned").length>0?bp.Nouveau.inject("#activity-stream ul.activity-list li:first.bb-pinned",a.data.activity,"after"):bp.Nouveau.inject("#activity-stream ul.activity-list",a.data.activity,"prepend"),jQuery(window).scroll())}i&&a.data.id&&(t("#activity-"+a.data.id).remove(),t('#activity-stream li.activity-item[data-bp-activity-id="'+a.data.id+'"]').remove())}else e.showNotification(a.data.message||buddybossSharingFrontend.i18n.error,"error")},error:function(){e.showNotification(buddybossSharingFrontend.i18n.error,"error")}})},shareDirectlyToGroup:function(){var e=this;this.selectedGroup&&this.selectedGroup.id?t.ajax({url:buddybossSharingFrontend.ajaxUrl,type:"POST",data:{action:"buddyboss_share_to_group",nonce:buddybossSharingFrontend.nonce,activity_id:this.currentActivityId,group_id:this.selectedGroup.id,custom_message:""},success:function(t){t.success?(e.showNotification(t.data.message||"Shared to group successfully!","success"),t.data.share_count&&e.updateShareCount(t.data.share_count),e.selectedGroup=null):e.showNotification(t.data.message||"Failed to share to group.","error")},error:function(){e.showNotification("An error occurred. Please try again.","error")}}):console.error("No group selected")},shareDirectlyToFriend:function(){var e=this;this.selectedFriend&&this.selectedFriend.id?t.ajax({url:buddybossSharingFrontend.ajaxUrl,type:"POST",data:{action:"buddyboss_share_to_friend_profile",nonce:buddybossSharingFrontend.nonce,activity_id:this.currentActivityId,friend_id:this.selectedFriend.id,custom_message:""},success:function(t){t.success?(e.showNotification(t.data.message||buddybossSharingFrontend.i18n.sharedSuccess,"success"),t.data.share_count&&e.updateShareCount(t.data.share_count),e.selectedFriend=null):e.showNotification(t.data.message||buddybossSharingFrontend.i18n.error,"error")},error:function(){e.showNotification(buddybossSharingFrontend.i18n.error,"error")}}):console.error("No friend selected")},handlePlatformClick:function(e){var a=this;e.preventDefault();var i=t(e.currentTarget).data("platform"),s=t(".share-link-url-input").val(),o="";switch(i){case"facebook":o="https://www.facebook.com/sharer/sharer.php?u=".concat(encodeURIComponent(s));break;case"twitter":o="https://twitter.com/intent/tweet?url=".concat(encodeURIComponent(s));break;case"linkedin":o="https://www.linkedin.com/sharing/share-offsite/?url=".concat(encodeURIComponent(s));break;case"whatsapp":o="https://wa.me/?text=".concat(encodeURIComponent(s));break;case"messenger":o="https://www.facebook.com/dialog/send?link=".concat(encodeURIComponent(s),"&app_id=YOUR_APP_ID&redirect_uri=").concat(encodeURIComponent(window.location.href))}o&&(window.open(o,"_blank","width=600,height=400"),setTimeout(function(){a.closeModal()},500))},handleCopyLink:function(e){e.preventDefault();var a=t(".share-link-url-input"),i=t(e.currentTarget),s=i.find("span").text();a.select(),document.execCommand("copy"),i.find("span").text("Copied!"),i.addClass("copied"),setTimeout(function(){i.find("span").text(s),i.removeClass("copied")},2e3)},handleShareSubmit:function(e){var a=this;e.preventDefault();var i,s=t(e.currentTarget),o="";if(o="message"===this.currentShareType?t("#share-message-content").val()||"":t(".share-custom-message").val()||"",i="message"===this.currentShareType?t('input[name="share_target[]"]:checked').map(function(){return t(this).val()}).get():t('input[name="share_target"]:checked').val()||"","group"===this.currentShareType||"profile"===this.currentShareType){if(!i)return void this.showError(buddybossSharingFrontend.i18n.selectTarget)}else if("message"===this.currentShareType&&(!i||0===i.length))return void this.showError(buddybossSharingFrontend.i18n.selectRecipient);s.prop("disabled",!0).html('<span class="spinner is-active"></span> Sharing...'),t.ajax({url:buddybossSharingFrontend.ajaxUrl,type:"POST",data:{action:"buddyboss_share_activity",nonce:buddybossSharingFrontend.nonce,activity_id:this.currentActivityId,share_type:this.currentShareType,share_target:i,custom_message:o},success:function(t){t.success?(a.clearDraftActivity(),a.showSuccess(t.data.message||buddybossSharingFrontend.i18n.sharedSuccess),t.data.share_count&&a.updateShareCount(t.data.share_count),setTimeout(function(){a.closeModal()},1500)):(a.showError(t.data.message||buddybossSharingFrontend.i18n.error),s.prop("disabled",!1).html('<i class="bb-icon-clock"></i> Post'))},error:function(){a.showError(buddybossSharingFrontend.i18n.error),s.prop("disabled",!1).html('<i class="bb-icon-clock"></i> Post')}})},handleSearch:function(e){var a=t(e.currentTarget).val().toLowerCase(),i=t(".share-target-item");if(a){i.each(function(){t(this).find(".target-name").text().toLowerCase().includes(a)?t(this).show():t(this).hide()});var s=i.filter(":visible").length,o=t(".no-results");0===s&&0===o.length?t(".share-target-list").append('<p class="no-results">No results found.</p>'):s>0&&o.remove()}else i.show()},handleKeyPress:function(e){if(27===e.keyCode){var a=t(".buddyboss-share-message-modal-container");this.activityModal.is(":visible")?this.closeActivityModal():a.is(":visible")||this.modal.is(":visible")||this.linkModal.is(":visible")?this.closeModal():this.dropdown.is(":visible")?this.closeDropdown():!this.currentActivityId||"feed"!==this.currentShareType&&"group"!==this.currentShareType&&"profile"!==this.currentShareType||t("#bb-rl-whats-new-form").find(".buddyboss-shared-activity-preview").length>0&&("feed"===this.currentShareType?this.cleanupSharedActivityForm():"group"===this.currentShareType?this.cleanupSharedActivityFormForGroup():"profile"===this.currentShareType&&this.cleanupSharedActivityFormForFriend())}},handleFormReset:function(e){!this.currentActivityId||"feed"!==this.currentShareType&&"group"!==this.currentShareType&&"profile"!==this.currentShareType||t("#bb-rl-whats-new-form").find(".buddyboss-shared-activity-preview").length>0&&("feed"===this.currentShareType?this.cleanupSharedActivityForm():"group"===this.currentShareType?this.cleanupSharedActivityFormForGroup():"profile"===this.currentShareType&&this.cleanupSharedActivityFormForFriend())},getActivityUrl:function(){var e=t('[data-activity-id="'.concat(this.currentActivityId,'"]')).closest(".activity-item").find(".activity-permalink");return e.length?e.attr("href"):window.location.href},updateShareCount:function(e){var a=t('.activity-state-shares[data-activity-id="'.concat(this.currentActivityId,'"]')),i=a.find(".shares-count-number"),s=a.find(".shares-count");i.length>0&&(i.text(e),s.attr("data-shares-count",e),1===e?s.html('<span class="shares-count-number">'+e+"</span> Share"):s.html('<span class="shares-count-number">'+e+"</span> Shares"),0===e?a.hide():a.show())},showNotification:function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",i="success";"error"===a?i="error":"warning"===a&&(i="warning"),t(document).trigger("bb_trigger_toast_message",["",e,i,null,!0,5])},showSuccess:function(e){var a=t('\n\t\t\t\t<div class="buddyboss-alert buddyboss-alert-success">\n\t\t\t\t\t<i class="bb-icon-check"></i>\n\t\t\t\t\t'.concat(e,"\n\t\t\t\t</div>\n\t\t\t"));t(".share-content-area").prepend(a),setTimeout(function(){a.fadeOut(300,function(){t(this).remove()})},3e3)},showError:function(e){var a=t('\n\t\t\t\t<div class="buddyboss-alert buddyboss-alert-error">\n\t\t\t\t\t<i class="bb-icon-exclamation-triangle"></i>\n\t\t\t\t\t'.concat(e,"\n\t\t\t\t</div>\n\t\t\t"));t(".share-content-area").prepend(a),setTimeout(function(){a.fadeOut(300,function(){t(this).remove()})},5e3)},handleMessageSend:function(e){var a=this;e.preventDefault();var i=t(e.currentTarget);if(this.selectedRecipients&&0!==this.selectedRecipients.length){var s=[],o=[];this.selectedRecipients.forEach(function(t){t.isThread?s.push(t.id):o.push(t.id)});var n=t("#share-message-activity-id").val();if(n){var r=t(".share-message-textarea").val()||"";i.prop("disabled",!0).text("Sending..."),t.ajax({url:buddybossSharingFrontend.ajaxUrl,type:"POST",data:{action:"buddyboss_share_to_message",nonce:buddybossSharingFrontend.nonce,activity_id:n,thread_ids:s,member_ids:o,custom_message:r},success:function(e){e.success?(a.showNotification(e.data.message||"Message sent successfully!","success"),e.data.share_count&&a.updateShareCount(e.data.share_count),a.selectedRecipients=[],a.renderSelectedRecipients(),t(".share-message-textarea").val(""),setTimeout(function(){a.closeModal()},1e3)):(a.showNotification(e.data.message||buddybossSharingFrontend.i18n.failedSendMessage,"error"),i.prop("disabled",!1).text("Send"))},error:function(){a.showNotification("An error occurred. Please try again.","error"),i.prop("disabled",!1).text("Send")}})}else this.showNotification("Activity ID not found.","error")}else this.showNotification("Please select at least one recipient or thread.","error")},loadRecentThreads:function(){var e=this,a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isLoadingThreads){var i=t(".share-message-loading"),s=t(".share-message-results");a||(this.currentPage=1,this.hasMorePages=!1,s.empty()),this.isLoadingThreads=!0,i.show(),t.ajax({url:buddybossSharingFrontend.ajaxUrl,type:"POST",data:{action:"buddyboss_get_recent_message_threads",nonce:buddybossSharingFrontend.messagesNonce||buddybossSharingFrontend.nonce,box:"inbox",page:a?this.currentPage+1:1,per_page:100},success:function(t){if(i.hide(),e.isLoadingThreads=!1,t.success&&t.data&&t.data.threads&&t.data.threads.length>0){e.currentPage=t.data.page||1,e.hasMorePages=t.data.has_more||!1;var o="";buddybossSharingFrontend.currentUserId,t.data.threads.forEach(function(t){var e="",a="",i=t.thread_id;if(t.is_group_thread&&t.group_avatar&&t.group_name)e='<img src="'.concat(t.group_avatar,'" alt="').concat(t.group_name,'" class="avatar group-avatar" />'),a=t.group_name;else if(t.avatars&&t.avatars.length>1)e=2===t.avatars.length?'\n\t\t\t\t\t\t\t\t\t\t<div class="thread-multiple-avatar">\n\t\t\t\t\t\t\t\t\t\t\t<img src="'.concat(t.avatars[0].url,'" alt="').concat(t.avatars[0].name,'" class="avatar" />\n\t\t\t\t\t\t\t\t\t\t\t<img src="').concat(t.avatars[1].url,'" alt="').concat(t.avatars[1].name,'" class="avatar" />\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t'):'\n\t\t\t\t\t\t\t\t\t\t<div class="thread-avatar-with-count">\n\t\t\t\t\t\t\t\t\t\t\t<span class="recipients-count">'.concat(t.recipientsCount||t.avatars.length,'</span>\n\t\t\t\t\t\t\t\t\t\t\t<img src="').concat(t.avatars[0].url,'" alt="').concat(t.avatars[0].name,'" class="avatar" />\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t'),a=Object.values(t.recipients||{}).slice(0,4).map(function(t){return t.name}).join(", "),t.toOthers&&(a+=" "+t.toOthers);else{var s=Object.values(t.recipients||{});if(s.length>0){var n=s[0];e='<img src="'.concat(n.avatar,'" alt="').concat(n.name,'" class="avatar" />'),a=n.name}}a&&(o+='\n\t\t\t\t\t\t\t\t\t<label class="share-message-thread-item bb-share-modal-list-item">\n\t\t\t\t\t\t\t\t\t\t<div class="thread-avatar">\n\t\t\t\t\t\t\t\t\t\t\t'.concat(e,'\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class="thread-info">\n\t\t\t\t\t\t\t\t\t\t\t<div class="thread-name">\n\t\t\t\t\t\t\t\t\t\t\t\t').concat(a,'\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class="thread-checkbox">\n\t\t\t\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\t\t\t\ttype="checkbox"\n\t\t\t\t\t\t\t\t\t\t\t\tname="share_message_recipients[]"\n\t\t\t\t\t\t\t\t\t\t\t\tvalue="').concat(i,'"\n\t\t\t\t\t\t\t\t\t\t\t\tdata-thread-id="').concat(i,'"\n\t\t\t\t\t\t\t\t\t\t\t\tclass="share-message-thread-checkbox"\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t'))}),o?(a?s.append(o):s.html(o),a||e.setupInfiniteScroll()):a||s.html('<p class="no-members-found" style="text-align: center; padding: 24px; color: #8c8f94;">No recent conversations found.</p>')}else a||s.html('<p class="no-members-found" style="text-align: center; padding: 24px; color: #8c8f94;">No recent conversations found.</p>')},error:function(){i.hide(),e.isLoadingThreads=!1,a||s.html('<p class="no-members-found" style="text-align: center; padding: 24px; color: #8c8f94;">Error loading recent conversations.</p>')}})}},setupInfiniteScroll:function(){var e=this,a=t(".share-message-members-list");a.off("scroll.infiniteThreads"),a.on("scroll.infiniteThreads",function(){var t=a.scrollTop();a[0].scrollHeight-t-a.outerHeight()<100&&e.hasMorePages&&!e.isLoadingThreads&&e.loadRecentThreads(!0)})},handleMessageSearch:function(e){var a=this,i=t(e.currentTarget).val().trim(),s=t(".share-message-loading"),o=t(".share-message-results");this.messageSearchTimeout&&clearTimeout(this.messageSearchTimeout),i?this.messageSearchTimeout=setTimeout(function(){s.show(),o.empty(),t.ajax({url:buddybossSharingFrontend.ajaxUrl,type:"POST",data:{action:"buddyboss_search_members_for_message",nonce:buddybossSharingFrontend.nonce,search:i},success:function(t){if(s.hide(),t.success&&t.data.members&&t.data.members.length>0){var e="";t.data.members.forEach(function(t){var i=a.selectedRecipients&&a.selectedRecipients.some(function(e){return e.id===t.id.toString()});e+='<label class="share-message-member-item bb-share-modal-list-item"><div class="member-avatar"><img src="'+t.avatar+'" alt="'+t.name+'" class="avatar" /></div><div class="member-name">'+t.name+'</div><div class="member-checkbox"><input type="checkbox" name="share_message_recipients[]" value="'+t.id+'" data-recipient-name="'+t.name+'" data-recipient-avatar="'+t.avatar+'" class="share-message-recipient-checkbox"'+(i?" checked":"")+" /></div></label>"}),o.html(e)}else o.html('<p class="no-members-found" style="text-align: center; padding: 24px; color: #8c8f94;">No members found.</p>')},error:function(){s.hide(),o.html('<p class="no-members-found" style="text-align: center; padding: 24px; color: #8c8f94;">Error searching members. Please try again.</p>')}})},300):this.loadRecentThreads()},initSelectedRecipients:function(){var e=this;this.selectedRecipients=[],t(document).on("change",'input[name="share_message_recipients[]"]',function(a){var i=t(a.target),s=i.val(),o=i.data("recipient-name")||i.closest("label").find(".thread-name, .member-name").text().trim(),n=i.data("recipient-avatar")||i.closest("label").find("img.avatar").first().attr("src"),r=i.hasClass("share-message-thread-checkbox");i.is(":checked")?e.addSelectedRecipient({id:s,name:o,avatar:n,isThread:r}):e.removeSelectedRecipient(s)})},addSelectedRecipient:function(t){this.selectedRecipients.some(function(e){return e.id===t.id})||(this.selectedRecipients.push(t),this.renderSelectedRecipients())},removeSelectedRecipient:function(e){this.selectedRecipients=this.selectedRecipients.filter(function(t){return t.id!==e}),t('input[name="share_message_recipients[]"][value="'+e+'"]').prop("checked",!1),this.renderSelectedRecipients()},renderSelectedRecipients:function(){var e=this,a=t(".share-message-selected-container");if(0!==this.selectedRecipients.length){var i="";this.selectedRecipients.forEach(function(t){var e=t.isThread?"data-thread-id":"data-user-id";i+='<div class="share-message-selected-chip" data-recipient-id="'+t.id+'" '+e+'="'+t.id+'"><img src="'+t.avatar+'" alt="'+t.name+'" class="chip-avatar" /><span class="chip-name">'+t.name+'</span><button type="button" class="chip-remove" data-recipient-id="'+t.id+'"><i class="bb-icon-l bb-icon-times"></i></button></div>'}),a.html(i).show(),a.find(".chip-remove").off("click").on("click",function(a){var i=t(a.currentTarget).data("recipient-id").toString();e.removeSelectedRecipient(i)})}else a.hide().empty()},saveSelectedRecipients:function(){},restoreSelectedRecipients:function(){this.selectedRecipients&&0!==this.selectedRecipients.length&&this.selectedRecipients.forEach(function(e){t('input[name="share_message_recipients[]"][value="'+e.id+'"]').prop("checked",!0)})},openGroupModal:function(){var e=this;t(".buddyboss-share-group-modal-container").remove();var a='\n\t\t\t\t<div class="buddyboss-share-group-modal-container bb-share-modal-container" style="display: none;">\n\t\t\t\t\t<div class="buddyboss-share-modal-overlay"></div>\n\t\t\t\t\t<div class="buddyboss-share-group-modal bb-share-modal">\n\t\t\t\t\t\t<div class="bb-share-modal-header">\n\t\t\t\t\t\t\t<h3>Share to a group</h3>\n\t\t\t\t\t\t\t<button type="button" class="share-group-close bb-share-modal-close">\n\t\t\t\t\t\t\t\t<i class="bb-icon-l bb-icon-times"></i>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="share-group-search bb-share-modal-search">\n\t\t\t\t\t\t\t<i class="bb-icon-l bb-icon-search"></i>\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t\t\tclass="share-group-search-input"\n\t\t\t\t\t\t\t\tplaceholder="Search for groups"\n\t\t\t\t\t\t\t\tautocomplete="off"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="share-group-content bb-share-modal-content">\n\t\t\t\t\t\t\t<div class="share-group-label bb-share-modal-label">\n\t\t\t\t\t\t\t\tAll Groups\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div class="share-group-list">\n\t\t\t\t\t\t\t\t<div class="share-group-loading" style="display: none;">\n\t\t\t\t\t\t\t\t\t<span class="spinner is-active"></span>\n\t\t\t\t\t\t\t\t\t<p>Loading...</p>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="share-group-results">\n\t\t\t\t\t\t\t\t\t\x3c!-- Groups will be loaded via AJAX --\x3e\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\x3c!-- Hidden field to store activity ID --\x3e\n\t\t\t\t\t\t<input type="hidden" id="share-group-activity-id" value="'.concat(this.currentActivityId,'" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t');t("body").append(a);var i=t(".buddyboss-share-group-modal-container");i.fadeIn(300),t("body").css("overflow","hidden"),i.find(".share-group-close, .buddyboss-share-modal-overlay").on("click",function(){e.closeGroupModal()}),this.loadGroupsForSharing(),i.find(".share-group-search-input").on("input",this.handleGroupSearch.bind(this))},closeGroupModal:function(){t(".buddyboss-share-group-modal-container").fadeOut(300,function(){t(this).remove()}),t("body").css("overflow","")},loadGroupsForSharing:function(){var e=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=t(".share-group-loading"),o=t(".share-group-results");s.show(),1===i&&o.empty(),t.ajax({url:buddybossSharingFrontend.ajaxUrl,type:"POST",data:{action:"buddyboss_get_groups_for_sharing",nonce:buddybossSharingFrontend.nonce,search:a,page:i},success:function(n){if(s.hide(),n.success&&n.data.groups&&n.data.groups.length>0){var r="";n.data.groups.forEach(function(t){var e=t.status_label;t.type_label&&(e+=" â€¢ "+t.type_label),r+='\n\t\t\t\t\t\t\t\t<div class="share-group-item bb-share-modal-list-item" data-group-id="'.concat(t.id,'">\n\t\t\t\t\t\t\t\t\t<div class="group-avatar">\n\t\t\t\t\t\t\t\t\t\t<img src="').concat(t.avatar,'" alt="').concat(t.name,'" class="avatar" />\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="group-info">\n\t\t\t\t\t\t\t\t\t\t<div class="group-name">').concat(t.name,'</div>\n\t\t\t\t\t\t\t\t\t\t<div class="group-meta">').concat(e,'</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="bb-share-list-item-caret">\n\t\t\t\t\t\t\t\t\t\t<i class="bb-icon-l bb-icon-angle-right"></i>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t')}),1===i?o.html(r):o.append(r),o.find(".share-group-item").off("click").on("click",function(a){var i=t(a.currentTarget),s=i.data("group-id"),o=i.find(".group-name").text(),n=i.find(".group-avatar img").attr("src");e.handleGroupSelection(s,o,n)})}else if(1===i){var d=a?"No groups match your search.":"No groups found.";o.html('\n\t\t\t\t\t\t\t<div class="no-groups-found">\n\t\t\t\t\t\t\t\t<div class="no-groups-icon">\n\t\t\t\t\t\t\t\t\t<i class="bb-icon-rf bb-icon-info-circle"></i>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="no-groups-message">'.concat(d,"</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t"))}},error:function(){s.hide(),1===i&&o.html('<p class="no-groups-found" style="text-align: center; padding: 24px; color: #8c8f94;">Error loading groups. Please try again.</p>')}})},handleGroupSearch:function(e){var a=this,i=t(e.currentTarget).val().trim();this.groupSearchTimeout&&clearTimeout(this.groupSearchTimeout),this.groupSearchTimeout=setTimeout(function(){a.loadGroupsForSharing(i,1)},300)},handleGroupSelection:function(e,a,i){this.selectedGroup={id:e,name:a,avatar:i},this.closeGroupModal(),buddybossSharingFrontend.enableCustomMsg?(t("body").addClass("bb-sharing-active"),this.openBuddyBossPostFormWithGroup(),this.loadAndInjectSharedActivityWithGroup()):this.shareDirectlyToGroup()},openBuddyBossPostFormWithGroup:function(){var e=this;this.clearDraftActivity();var a=t("#bb-rl-whats-new-form"),i=t("#bb-rl-activity-form");if(a.length&&i.length){var s=t("#bb-rl-whats-new"),o=a.closest(".bb-rl-activity-update-form"),n=t("#bb-rl-single-activity-edit-form-wrap");n.length&&n.is(":hidden")&&n.show(),o.length&&o.is(":hidden")&&o.show(),a.length&&a.is(":hidden")&&a.show(),s.length?setTimeout(function(){o.length&&!o.hasClass("modal-popup")&&(o.addClass("modal-popup"),t("body").addClass("bb-rl-activity-modal-open")),n.length&&n.show(),o.length&&o.show(),a.length&&a.show(),s.focus(),setTimeout(function(){e.setGroupPrivacyInForm(e.selectedGroup),e.loadAndInjectSharedActivityWithGroup()},300)},100):console.warn("BuddyBoss post form not found")}else this.loadActivityPostForm().then(function(){e.openBuddyBossPostForm(),setTimeout(function(){e.setGroupPrivacyInForm(e.selectedGroup),e.loadAndInjectSharedActivityWithGroup()},400)}).catch(function(t){console.error("Failed to load activity post form for group:",t),e.showNotification(buddybossSharingFrontend.i18n.error||"Failed to load post form","error")})},setGroupPrivacyInForm:function(e){if("undefined"!=typeof bp&&bp.Nouveau&&bp.Nouveau.Activity&&bp.Nouveau.Activity.postForm){var a=bp.Nouveau.Activity.postForm.model;if(a){a.set("item_id",e.id),a.set("privacy","group"),a.set("item_name",e.name),a.set("group_name",e.name),a.set("group_image",e.avatar),a.set("object","groups");var i=t("#bb-rl-whats-new-form");i.find(".bp-activity-privacy-status").text(e.name),i.find("#bp-activity-privacy-point").removeClass().addClass("group"),e.avatar&&!e.avatar.includes("mystery-group")?i.find("#bp-activity-privacy-point span.privacy-point-icon").removeClass("privacy-point-icon").addClass("group-privacy-point-icon").html('<img src="'.concat(e.avatar,'" alt="').concat(e.name,'" />')):(i.find("#bp-activity-privacy-point span.group-privacy-point-icon img").remove(),i.find("#bp-activity-privacy-point span.group-privacy-point-icon").removeClass("group-privacy-point-icon").addClass("privacy-point-icon")),i.removeClass("focus-in--privacy focus-in--group"),"undefined"!=typeof Backbone&&Backbone.trigger("privacy:updatestatus")}else console.warn("BuddyBoss post form model not found")}else console.warn("BuddyBoss Backbone model not available")},loadAndInjectSharedActivityWithGroup:function(){var e=this;setTimeout(function(){t.ajax({url:buddybossSharingFrontend.ajaxUrl,type:"POST",data:{action:"buddyboss_get_activity_content",nonce:buddybossSharingFrontend.nonce,activity_id:e.currentActivityId},success:function(t){t.success&&e.injectSharedActivityToFormWithGroup(t.data.content)},error:function(){console.error(buddybossSharingFrontend.i18n.failedLoadActivity)}})},400)},injectSharedActivityToFormWithGroup:function(e){var a=t("#bb-rl-whats-new-form");a.find("#buddyboss-shared-activity-id").length||a.append('<input type="hidden" id="buddyboss-shared-activity-id" value="'.concat(this.currentActivityId,'">')),a.find("#buddyboss-shared-group-id").length||a.append('<input type="hidden" id="buddyboss-shared-group-id" value="'.concat(this.selectedGroup.id,'">'));var i=t("#bb-rl-whats-new"),s=a.find(".buddyboss-shared-activity-preview");0===s.length&&(s=t('<div class="buddyboss-shared-activity-preview"></div>'),i.parent().after(s)),s.html(e),this.initializeLazyLoading(s),this.initializeVideoJS(s),this.disableUploadButtons(),this.hookFormSubmissionForGroup(),"undefined"!=typeof bp&&bp.Nouveau&&bp.Nouveau.Activity&&bp.Nouveau.Activity.postForm&&bp.Nouveau.Activity.postForm.postForm&&bp.Nouveau.Activity.postForm.postForm.postValidate()},hookFormSubmissionForGroup:function(){var e=this;t("#bb-rl-whats-new-form").off("submit.buddyboss-share-group");var a=document.getElementById("bb-rl-whats-new-form");a&&(a._buddybossShareGroupHandler&&a.removeEventListener("submit",a._buddybossShareGroupHandler,!0),a._buddybossShareGroupHandler=function(a){var i=document.getElementById("buddyboss-shared-activity-id"),s=document.getElementById("buddyboss-shared-group-id");if(i&&i.value&&s&&s.value){a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation();var o=t("#bb-rl-whats-new"),n="";return o.is("[contenteditable]")?(o.find("img.emojioneemoji, img.bb-rl-emojioneemoji").replaceWith(function(){return this.dataset.emojiChar}),n=(n=t.trim(o[0].innerHTML.replace(/<div>/gi,"\n").replace(/<\/div>/gi,""))).replace(/&nbsp;/g," ")):n=o.val().trim(),e.submitSharedActivityToGroup(i.value,s.value,n),!1}},a.addEventListener("submit",a._buddybossShareGroupHandler,!0))},submitSharedActivityToGroup:function(e,a,i){var s=this,o=t("#aw-whats-new-submit"),n=o.text();o.prop("disabled",!0).text("Posting..."),t.ajax({url:buddybossSharingFrontend.ajaxUrl,type:"POST",data:{action:"buddyboss_share_to_group",nonce:buddybossSharingFrontend.nonce,activity_id:e,group_id:a,custom_message:i},success:function(e){e.success?(s.showNotification(e.data.message||"Shared to group successfully!","success"),e.data.share_count&&s.updateShareCount(e.data.share_count),s.clearDraftActivity(),s.cleanupSharedActivityFormForGroup(),t("#bb-rl-whats-new-form").trigger("reset")):(s.showNotification(e.data.message||"Failed to share to group.","error"),o.prop("disabled",!1).text(n))},error:function(t,e,a){console.error("AJAX error:",{xhr:t,status:e,error:a}),s.showNotification("An error occurred. Please try again.","error"),o.prop("disabled",!1).text(n)}})},cleanupSharedActivityFormForGroup:function(){t("#buddyboss-shared-activity-id").remove(),t("#buddyboss-shared-group-id").remove(),t(".buddyboss-shared-activity-preview").remove(),t("#bb-rl-whats-new-form").off("submit.buddyboss-share-group"),t("body").removeClass("bb-sharing-active");var e=document.getElementById("bb-rl-whats-new-form");e&&e._buddybossShareGroupHandler&&(e.removeEventListener("submit",e._buddybossShareGroupHandler,!0),delete e._buddybossShareGroupHandler);var a=t('#bb-rl-whats-new-toolbar[data-share-disabled="true"]');a.length&&a.show().removeAttr("data-share-disabled"),this.hideEditFormWrapOnSingleActivityPage(),this.selectedGroup=null,"undefined"!=typeof bp&&bp.Nouveau&&bp.Nouveau.Activity&&bp.Nouveau.Activity.postForm&&bp.Nouveau.Activity.postForm.postForm&&bp.Nouveau.Activity.postForm.postForm.postValidate()},openFriendsModal:function(){var e=this;t(".buddyboss-share-friends-modal-container").remove();var a='\n\t\t\t\t<div class="buddyboss-share-friends-modal-container bb-share-modal-container" style="display: none;">\n\t\t\t\t\t<div class="buddyboss-share-modal-overlay"></div>\n\t\t\t\t\t<div class="buddyboss-share-friends-modal bb-share-modal">\n\t\t\t\t\t\t<div class="share-friends-header bb-share-modal-header">\n\t\t\t\t\t\t\t<h3>Share to friend\'s profile</h3>\n\t\t\t\t\t\t\t<button type="button" class="share-friends-close bb-share-modal-close">\n\t\t\t\t\t\t\t\t<i class="bb-icon-l bb-icon-times"></i>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="share-friends-search bb-share-modal-search">\n\t\t\t\t\t\t\t<i class="bb-icon-l bb-icon-search"></i>\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t\t\tclass="share-friends-search-input"\n\t\t\t\t\t\t\t\tplaceholder="Search for members"\n\t\t\t\t\t\t\t\tautocomplete="off"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="share-friends-content bb-share-modal-content">\n\t\t\t\t\t\t\t<div class="share-friends-label bb-share-modal-label">\n\t\t\t\t\t\t\t\tAll Friends\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div class="share-friends-list">\n\t\t\t\t\t\t\t\t<div class="share-friends-loading" style="display: none;">\n\t\t\t\t\t\t\t\t\t<span class="spinner is-active"></span>\n\t\t\t\t\t\t\t\t\t<p>Loading...</p>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="share-friends-results">\n\t\t\t\t\t\t\t\t\t\x3c!-- Friends will be loaded via AJAX --\x3e\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\x3c!-- Hidden field to store activity ID --\x3e\n\t\t\t\t\t\t<input type="hidden" id="share-friends-activity-id" value="'.concat(this.currentActivityId,'" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t');t("body").append(a);var i=t(".buddyboss-share-friends-modal-container");i.fadeIn(300),t("body").css("overflow","hidden"),i.find(".share-friends-close, .buddyboss-share-modal-overlay").on("click",function(){e.closeFriendsModal()}),this.loadFriendsForSharing(),i.find(".share-friends-search-input").on("input",this.handleFriendSearch.bind(this))},closeFriendsModal:function(){t(".buddyboss-share-friends-modal-container").fadeOut(300,function(){t(this).remove()}),t("body").css("overflow","")},loadFriendsForSharing:function(){var e=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=t(".share-friends-loading"),o=t(".share-friends-results");s.show(),1===i&&o.empty(),t.ajax({url:buddybossSharingFrontend.ajaxUrl,type:"POST",data:{action:"buddyboss_get_friends_for_sharing",nonce:buddybossSharingFrontend.nonce,search:a,page:i},success:function(n){if(s.hide(),n.success&&n.data.friends&&n.data.friends.length>0){var r="";n.data.friends.forEach(function(t){r+='\n\t\t\t\t\t\t\t\t<div class="share-friends-item bb-share-modal-list-item" data-user-id="'.concat(t.id,'">\n\t\t\t\t\t\t\t\t\t<div class="friend-avatar">\n\t\t\t\t\t\t\t\t\t\t<img src="').concat(t.avatar,'" alt="').concat(t.name,'" class="avatar" />\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="friend-name">').concat(t.name,'</div>\n\t\t\t\t\t\t\t\t\t<div class="bb-share-list-item-caret">\n\t\t\t\t\t\t\t\t\t\t<i class="bb-icon-l bb-icon-angle-right"></i>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t')}),1===i?o.html(r):o.append(r),o.find(".share-friends-item").off("click").on("click",function(a){var i=t(a.currentTarget),s=i.data("user-id"),o=i.find(".friend-name").text(),n=i.find(".friend-avatar img").attr("src");e.handleFriendSelection(s,o,n)})}else if(1===i){var d=a?"Sorry, no members were found.":"No friends found.";o.html('\n\t\t\t\t\t\t\t<div class="no-friends-found">\n\t\t\t\t\t\t\t\t<div class="no-friends-icon">\n\t\t\t\t\t\t\t\t\t<i class="bb-icon-rf bb-icon-info-circle"></i>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="no-friends-message">'.concat(d,"</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t"))}},error:function(){s.hide(),1===i&&o.html('\n\t\t\t\t\t\t\t<div class="no-friends-found">\n\t\t\t\t\t\t\t\t<div class="no-friends-icon">\n\t\t\t\t\t\t\t\t\t<i class="bb-icon-rf bb-icon-info-circle"></i>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="no-friends-message">Error loading friends. Please try again.</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t')}})},handleFriendSearch:function(e){var a=this,i=t(e.currentTarget).val().trim();this.friendSearchTimeout&&clearTimeout(this.friendSearchTimeout),this.friendSearchTimeout=setTimeout(function(){a.loadFriendsForSharing(i,1)},300)},handleFriendSelection:function(e,a,i){this.selectedFriend={id:e,name:a,avatar:i},this.closeFriendsModal(),buddybossSharingFrontend.enableCustomMsg?(t("body").addClass("bb-sharing-active"),this.openBuddyBossPostFormWithFriend(),this.loadAndInjectSharedActivityWithFriend()):this.shareDirectlyToFriend()},openBuddyBossPostFormWithFriend:function(){var e=this;this.clearDraftActivity();var a=t("#bb-rl-whats-new-form"),i=t("#bb-rl-activity-form");if(a.length&&i.length){var s=t("#bb-rl-whats-new"),o=a.closest(".bb-rl-activity-update-form"),n=t("#bb-rl-single-activity-edit-form-wrap");n.length&&n.is(":hidden")&&n.show(),o.length&&o.is(":hidden")&&o.show(),a.length&&a.is(":hidden")&&a.show(),s.length?setTimeout(function(){o.length&&!o.hasClass("modal-popup")&&(o.addClass("modal-popup"),t("body").addClass("bb-rl-activity-modal-open")),n.length&&n.show(),o.length&&o.show(),a.length&&a.show(),s.focus(),setTimeout(function(){e.setFriendProfileInForm(e.selectedFriend),e.loadAndInjectSharedActivityWithFriend()},300)},100):console.warn("BuddyBoss post form not found")}else this.loadActivityPostForm().then(function(){e.openBuddyBossPostForm(),setTimeout(function(){e.setFriendProfileInForm(e.selectedFriend),e.loadAndInjectSharedActivityWithFriend()},400)}).catch(function(t){console.error("Failed to load activity post form for friend:",t),e.showNotification(buddybossSharingFrontend.i18n.error||"Failed to load post form","error")})},setFriendProfileInForm:function(e){var a=t("#bb-rl-whats-new-form").find('select[name="whats-new-post-in"]');a.length?a.val(e.id).trigger("change"):console.warn("Post-in select element not found")},loadAndInjectSharedActivityWithFriend:function(){var e=this;setTimeout(function(){t.ajax({url:buddybossSharingFrontend.ajaxUrl,type:"POST",data:{action:"buddyboss_get_activity_content",nonce:buddybossSharingFrontend.nonce,activity_id:e.currentActivityId},success:function(t){t.success&&e.injectSharedActivityToFormWithFriend(t.data.content)},error:function(){console.error(buddybossSharingFrontend.i18n.failedLoadActivity)}})},300)},injectSharedActivityToFormWithFriend:function(e){var a=t("#bb-rl-whats-new-form");a.find("#buddyboss-shared-activity-id").length||a.append('<input type="hidden" id="buddyboss-shared-activity-id" value="'.concat(this.currentActivityId,'">')),a.find("#buddyboss-shared-friend-id").length||a.append('<input type="hidden" id="buddyboss-shared-friend-id" value="'.concat(this.selectedFriend.id,'">'));var i=t("#bb-rl-whats-new"),s=a.find(".buddyboss-shared-activity-preview");s.length||(s=t('<div class="buddyboss-shared-activity-preview"></div>'),i.parent().after(s)),s.html(e),this.initializeVideoJS(s),this.disableUploadButtons(),this.hookFormSubmissionForFriend(),"undefined"!=typeof bp&&bp.Nouveau&&bp.Nouveau.Activity&&bp.Nouveau.Activity.postForm&&bp.Nouveau.Activity.postForm.postForm&&bp.Nouveau.Activity.postForm.postForm.postValidate()},hookFormSubmissionForFriend:function(){var e=this;t("#bb-rl-whats-new-form").off("submit.buddyboss-share-friend");var a=document.getElementById("bb-rl-whats-new-form");a?(a._buddybossShareFriendHandler&&a.removeEventListener("submit",a._buddybossShareFriendHandler,!0),a._buddybossShareFriendHandler=function(a){var i=document.getElementById("buddyboss-shared-activity-id"),s=document.getElementById("buddyboss-shared-friend-id");if(i&&i.value&&s&&s.value){a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation();var o=t("#bb-rl-whats-new"),n="";return n=o.is("[contenteditable]")?o.text().trim():o.val().trim(),e.submitSharedActivityToFriend(i.value,s.value,n),!1}},a.addEventListener("submit",a._buddybossShareFriendHandler,!0)):console.error("Form #bb-rl-whats-new-form not found!")},submitSharedActivityToFriend:function(e,a,i){var s=this,o=t("#aw-whats-new-submit"),n=o.text();o.prop("disabled",!0).text("Posting..."),t.ajax({url:buddybossSharingFrontend.ajaxUrl,type:"POST",data:{action:"buddyboss_share_to_friend_profile",nonce:buddybossSharingFrontend.nonce,activity_id:e,friend_id:a,custom_message:i},success:function(e){e.success?(s.showNotification(e.data.message||buddybossSharingFrontend.i18n.sharedSuccess,"success"),e.data.share_count&&s.updateShareCount(e.data.share_count),s.clearDraftActivity(),s.cleanupSharedActivityFormForFriend(),t("#bb-rl-whats-new-form").trigger("reset")):(s.showNotification(e.data.message||buddybossSharingFrontend.i18n.error,"error"),o.prop("disabled",!1).text(n))},error:function(t,e,a){console.error("AJAX error:",{xhr:t,status:e,error:a}),s.showNotification(buddybossSharingFrontend.i18n.error,"error"),o.prop("disabled",!1).text(n)}})},cleanupSharedActivityFormForFriend:function(){t("#buddyboss-shared-activity-id").remove(),t("#buddyboss-shared-friend-id").remove(),t(".buddyboss-shared-activity-preview").remove(),t("#bb-rl-whats-new-form").off("submit.buddyboss-share-friend"),t("body").removeClass("bb-sharing-active");var e=document.getElementById("bb-rl-whats-new-form");e&&e._buddybossShareFriendHandler&&(e.removeEventListener("submit",e._buddybossShareFriendHandler,!0),delete e._buddybossShareFriendHandler);var a=t('#bb-rl-whats-new-toolbar[data-share-disabled="true"]');a.length&&a.show().removeAttr("data-share-disabled"),this.hideEditFormWrapOnSingleActivityPage(),"undefined"!=typeof bp&&bp.Nouveau&&bp.Nouveau.Activity&&bp.Nouveau.Activity.postForm&&bp.Nouveau.Activity.postForm.postForm&&bp.Nouveau.Activity.postForm.postForm.postValidate(),this.selectedFriend=null},handleSharedActivityClick:function(e){var a=t(e.target);if(!(a.is("a.shared-activity-read-more")||a.closest("a.shared-activity-read-more").length>0)){e.preventDefault(),e.stopPropagation();var i=t(e.currentTarget).data("activity-id");i?this.openSharedActivityModal(i):console.warn("No activity ID found on shared activity preview")}},openSharedActivityModal:function(e){var a=this;t.ajax({url:buddybossSharingFrontend.ajaxUrl,type:"POST",data:{action:"buddyboss_load_shared_activity_modal",nonce:buddybossSharingFrontend.nonce,activity_id:e},success:function(i){if(i.success&&i.data){var s=t(i.data.activity_html);s.attr("id","activity-"+e);var o=t("#bb-shared-activity-temp-container");0===o.length&&(o=t('<div id="bb-shared-activity-temp-container" style="display: none;"></div>'),t("body").append(o)),o.append(s),"undefined"!=typeof bp&&bp.Nouveau&&bp.Nouveau.Activity&&bp.Nouveau.Activity.launchActivityPopup?(bp.Nouveau.Activity.launchActivityPopup(e,0),setTimeout(function(){var e=t("#activity-modal"),i=t(".bb-activity-model-wrapper");e.length&&e.addClass("bb-shared-activity-modal"),i.length&&i.addClass("bb-shared-activity-modal"),s.remove(),"undefined"!=typeof bp&&bp.Nouveau&&"function"==typeof bp.Nouveau.lazyLoad&&(bp.Nouveau.lazyLoad(e.find(".lazy")),setTimeout(function(){jQuery(window).scroll()},50)),a.playVideoInModal&&(a.playVideoInModal=!1,setTimeout(function(){var t=e.find(".vjs-big-play-button");if(t.length>0)t.trigger("click");else{var a=e.find(".video-js");if(a.length>0){var i=a.attr("id");if(i&&"undefined"!=typeof videojs){var s=videojs.getPlayer(i);s&&s.play()}}}},300))},100)):(console.error("Platform activity modal system not available"),s.remove(),a.playVideoInModal=!1,alert("Activity modal system not available"))}else{var n;console.error("Failed to load activity data:",i),a.playVideoInModal=!1,alert((null===(n=i.data)||void 0===n?void 0:n.message)||"Failed to load activity")}},error:function(t,e,i){console.error("AJAX error loading shared activity:",{xhr:t,status:e,error:i}),a.playVideoInModal=!1,alert("Failed to load activity. Please try again.")}})},cleanupSharedActivityModalClass:function(){var e=t("#activity-modal"),a=t(".bb-activity-model-wrapper");e.length&&e.hasClass("bb-shared-activity-modal")&&e.removeClass("bb-shared-activity-modal"),a.length&&a.hasClass("bb-shared-activity-modal")&&a.removeClass("bb-shared-activity-modal"),this.playVideoInModal=!1,this.closeDropdown()}};t(document).ready(function(){e.init()})}(jQuery);