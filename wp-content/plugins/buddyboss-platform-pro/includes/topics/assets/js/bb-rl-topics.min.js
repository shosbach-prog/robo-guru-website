!function(s){var l={start:function(){"undefined"!=typeof BBTopicsManager&&(BBTopicsManager.config.modalSelector="#bb-rl-activity-topic-form_modal",BBTopicsManager.config.modalOpenClass="bb-topic-modal-open",BBTopicsManager.config.closeModalSelector=".bb-model-close-button, .bb-topic-cancel",BBTopicsManager.config.migrateTopicContainerModal="#bb-rl-activity-migrate-topic_modal"),this.addListeners()},addListeners:function(){s(document).on("bb_modal_opened",this.initializeSelect2.bind(this)),s(document).on("bb_modal_closed",this.destroySelect2.bind(this))},initializeSelect2:function(){var a,c=s(".bb_topic_name_select");c.length&&(a=c.data("existing-slugs")||[],c.data("select2")&&c.select2("destroy"),c.select2({theme:"bb-activity-topic",dropdownParent:s("#bb-rl-activity-topic-form_modal").length?s("#bb-rl-activity-topic-form_modal"):s(".bb-modal-panel--activity-topic"),width:"100%",allowClear:!0,tags:"allow_both"===bbTopics.group_topic_options||"create_own_topics"===bbTopics.group_topic_options,createTag:function(e){var t,i,o,n;return"only_from_activity_topics"===bbTopics.group_topic_options||""===(t=s.trim(e.term))?null:(i=(t=t.replace(/[<>]/g,"")).toLowerCase(),e=["script","javascript","vbscript","data:","alert"].some(function(e){return-1!==i.indexOf(e)}),(n=s("#bb-rl-activity-topic-form_modal .bb-hello-error")).length&&n.remove(),e?(s("#bb-rl-activity-topic-form_modal").find(".bb-action-popup-content").prepend('<div class="bb-hello-error"><i class="bb-icon-rf bb-icon-exclamation"></i>'+bbTopicsManagerVars.error_message+"</div>"),null):(o=!1,c.find("option").each(function(){if(s(this).text().toLowerCase()===t.toLowerCase())return!(o=!0)}),o?null:{id:n=l.generateUniqueSlug(a,t),text:t,isNew:!0,slug:n}))},insertTag:function(e,t){e.push(t)},templateResult:function(e){return e.isNew?s('<span class="bb-topic-create-new"><i class="bb-icon-plus"></i> Create "<b>'+e.text+'</b>" '+bbTopicsManagerVars.create_new_topic_text+"</span>"):s("<span>"+e.text+"</span>")},templateSelection:function(e){var t=!1;return e.element&&s(e.element).data("is-global-activity")&&(t=!0===s(e.element).data("is-global-activity")),!e.isNew&&t?s("<span>"+e.text+' <i class="bb-icon-globe"></i></span>'):e.text}}).on("select2:open",function(){s(".select2-dropdown").css("z-index",999999)}).on("select2:select",function(e){var e=e.params.data,t=e.isNew?{name:e.text,slug:e.slug,isNew:!0,is_global_activity:e.is_global_activity}:{name:e.text,id:e.id,isNew:!1,is_global_activity:e.is_global_activity};c.data("selected",t),c.val(e.text),s(this).next(".select2-container").find(".select2-selection--single").addClass("select2-selection--single--with-selection")}).on("select2:unselect",function(){s(this).next(".select2-container").find(".select2-selection--single").removeClass("select2-selection--single--with-selection")}))},destroySelect2:function(){var e=s(".bb_topic_name_select");e.data("select2")&&e.select2("destroy")},generateUniqueSlug:function(e,t){var i=t.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"");if(e.includes(i))for(var o=i,n=1;e.includes(i);)i=o+"-"+n,n++;return i}};l.start(),window.BBTopics=l}(jQuery);